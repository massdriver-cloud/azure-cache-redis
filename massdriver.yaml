schema: draft-07
name: azure-cache-redis
description: 'Azure Redis Cache is low-latency, scalable, secure, and highly available in-memory Redis data store available for Azure.'
ref: github.com/massdriver-cloud/massdriver-bundles
access: private
type: bundle

steps:
  - path: src
    provisioner: terraform

params:
  examples:
    - __name: Development
      capacity: 1
      replicas_per_primary: 1
    - __name: Production
      capacity: 3
      replicas_per_primary: 2
  required:
    - capacity
    - replicas_per_primary
  properties:
    redis_version:
      type: string
      title: Version
      description: Azure Cache for Redis offers the latest major version of Redis and at least one previous version. This version can be upgraded, but not downgraded.
      default: "6"
      enum:
        - "4"
        - "6"
    capacity:
      type: integer
      title: Cache size
      description: The size of the Redis memory cache.
      oneOf:
        - title: 6GB
          const: 1
        - title: 13GB
          const: 2
        - title: 26GB
          const: 3
        - title: 53GB
          const: 4
        - title: 120GB
          const: 5
    replicas_per_primary:
      type: integer
      title: Replicas
      description: Number of read replicas per primary node. When the primary VM becomes unavailable, the replica detects that and takes over as the new primary automatically.
      enum:
        - 1
        - 2
        - 3
    enable_cluster:
      type: boolean
      title: Redis clustering
      description: Redis cluster automatically shards data across multiple Redis nodes, so you can create workloads of bigger memory sizes and get better performance. Once enabled, clustering cannot be disabled again.
      $md.immutable: true
      default: false
    shard_count:
      type: integer
      title: Redis cluster shard count
      description: Set the number of shards in the Redis cluster. You must Enable Redis clustering and deploy that change before you can use this feature.
      default: 1
      enum:
        - 1
        - 2
        - 3
        - 4
        - 5
        - 6
        - 7
        - 8
        - 9
        - 10

connections:
  required:
    - azure_service_principal
    - vnet
  properties:
    azure_service_principal:
      $ref: massdriver/azure-service-principal
    vnet:
      $ref: massdriver/azure-virtual-network

artifacts:
  required:
    - authentication
  properties:
    authentication:
      $ref: massdriver/redis-authentication

ui:
  ui:order:
    - redis_version
    - capacity
    - replicas_per_primary
    - enable_cluster
    - shard_count
    - '*'
